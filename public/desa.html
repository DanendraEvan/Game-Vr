const dialogData = {
    koordinator: {
        speaker: "Dr. Ahmad Surya - Koordinator Peneliti",
        text: "Selamat datang di Desa Harmoni! Sebagai sosiolog senior, tugasmu adalah mengumpulkan data obyektif tentang konflik kompleks antara sektor pertanian dan industri. Ingat, kebenaran sosiologis terletak pada triangulasi data dari berbagai sumber.",
        tag: "Briefing",
        choices: [
            {
                text: "üî¨ Panduan Metodologi Penelitian", 
                submenu: "koordinator_metodologi"
            },
            {
                text: "üë• Identifikasi Key Informants", 
                submenu: "koordinator_informants"
            },
            {
                text: "‚úÖ Validasi Data & Bukti", 
                submenu: "koordinator_validasi"
            }
        ]
    },
    koordinator_metodologi: {
        speaker: "Dr. Ahmad Surya - Metodologi Penelitian",
        text: "Metodologi penelitian yang tepat adalah kunci keberhasilan riset sosial. Mari kita bahas pendekatan yang sesuai.",
        tag: "Metode",
        choices: [
            {
                text: "Pendekatan Kualitatif - Etnografi Partisipatif", 
                response: "Gunakan pendekatan etnografi partisipatif. Observasi langsung kondisi lapangan, wawancara mendalam dengan stakeholder, dan analisis dokumen sekunder. Ini memungkinkan pemahaman konteks sosial yang mendalam."
            },
            {
                text: "Mixed Methods - Triangulasi Data", 
                response: "Kombinasikan data kualitatif dan kuantitatif. Wawancara mendalam untuk memahami perspektif, survei untuk mengukur sikap, dan observasi untuk memvalidasi temuan. Triangulasi memberikan hasil yang lebih valid."
            },
            {
                text: "Analisis Bias & Subjektivitas", 
                response: "Catat bias potensial dari setiap sumber informasi. Setiap stakeholder punya kepentingan. Sebagai peneliti, Anda harus sadar posisi Anda sendiri dan bagaimana itu memengaruhi interpretasi data."
            }
        ]
    },
    koordinator_informants: {
        speaker: "Dr. Ahmad Surya - Key Informants",
        text: "Identifikasi informan kunci yang tepat akan menentukan kualitas data yang Anda kumpulkan.",
        tag: "Informan",
        choices: [
            {
                text: "Pak Seno - Petani Senior (Pengalaman 20 tahun)", 
                response: "Pak Seno sebagai petani senior dengan pengalaman 20 tahun. Dia punya perspektif historis tentang perubahan kondisi pertanian. Namun ingat, dia juga punya kepentingan ekonomi yang mungkin memengaruhi narasinya."
            },
            {
                text: "Bu Anita - Pemilik Pabrik (Latar Teknik Lingkungan)", 
                response: "Bu Anita pemilik pabrik dengan latar belakang teknik lingkungan. Dia memahami aspek teknis operasional tetapi juga punya kepentingan bisnis. Perspektifnya penting untuk memahami sisi industri."
            },
            {
                text: "Data Objektif - Perpustakaan & Kepala Desa", 
                response: "Data objektif di perpustakaan dan kepala desa sebagai mediator. Dokumen resmi dan pihak netral akan memberikan konteks yang lebih seimbang untuk analisis Anda."
            }
        ]
    },
    koordinator_validasi: {
        speaker: "Dr. Ahmad Surya - Validasi Data",
        text: "Validitas data adalah fondasi kredibilitas penelitian sosiologi.",
        tag: "Validasi",
        choices: [
            {
                text: "Cross-Validation Multiple Sources", 
                response: "Cross-check informasi dari multiple sources. Jangan bergantung pada satu sumber saja. Bandingkan data dari petani, pabrik, dan dokumen resmi untuk menemukan konsistensi atau kontradiksi."
            },
            {
                text: "Analisis Kredibilitas & Konsistensi", 
                response: "Perhatikan konsistensi data dan kredibilitas sumber. Apakah informasi yang diberikan konsisten sepanjang waktu? Apakah sumber memiliki track record yang bisa dipercaya?"
            },
            {
                text: "Dokumentasi Empiris", 
                response: "Dokumentasi foto, video, atau pengukuran langsung akan memperkuat validitas temuan Anda. Bukti empiris yang terukur lebih kuat daripada testimoni subjektif."
            }
        ]
    },
    farmer: {
        speaker: "Pak Seno - Petani Senior",
        text: "Selamat datang di desa kami, Pak. Saya sudah bertani di sini 20 tahun. Belakangan ini ada banyak perubahan yang membuat kami petani khawatir. Kondisi memang tidak seperti dulu lagi.",
        tag: "Testimoni",
        choices: [
            {
                text: "üåæ Kondisi Lahan & Hasil Panen", 
                submenu: "farmer_kondisi"
            },
            {
                text: "üè≠ Dampak Keberadaan Pabrik", 
                submenu: "farmer_pabrik"
            },
            {
                text: "ü§ù Solusi & Harapan", 
                submenu: "farmer_solusi"
            }
        ]
    },
    farmer_kondisi: {
        speaker: "Pak Seno - Kondisi Lahan & Panen",
        text: "Tentang kondisi lahan dan hasil panen dua tahun terakhir ini...",
        tag: "Analisis",
        choices: [
            {
                text: "Data Spesifik - Penurunan 30% & Perubahan Visual", 
                response: "Dua tahun terakhir, daun padi banyak yang menguning tidak wajar. Hasil panen menurun drastis sampai 30%, padahal sebelumnya selalu cukup untuk kebutuhan keluarga. Saya catat perubahan itu mulai setelah pabrik berdiri tahun 2022."
            },
            {
                text: "Observasi Komparatif - Banding dengan Area Lain", 
                response: "Yang jelas, air irigasi makin keruh, baunya menyengat. Saya bandingkan dengan sawah Pak Harjo di ujung desa yang jauh dari pabrik, wilayahnya yang airnya masih bersih hasilnya jauh lebih baik. Ada pola yang jelas di sini."
            },
            {
                text: "Perspektif Umum - Nasib Petani", 
                response: "Ya panennya memang nggak begitu bagus, tapi ya sudah namanya nasib petani kadang untung kadang rugi. Musim juga tidak menentu akhir-akhir ini."
            }
        ]
    },
    farmer_pabrik: {
        speaker: "Pak Seno - Dampak Keberadaan Pabrik",
        text: "Tentang perubahan yang terjadi sejak pabrik beroperasi...",
        tag: "Observasi",
        choices: [
            {
                text: "Analisis Kausal - Air & Lingkungan", 
                response: "Setelah ada pabrik, perubahan air irigasi paling kentara. Warna keruh, bau kimia, dan ikan-ikan di saluran banyak yang mati. Ini bukan kebetulan, timing-nya pas setelah pabrik mulai produksi massal."
            },
            {
                text: "Dampak Ekonomi - Penurunan Produktivitas", 
                response: "Selain masalah lingkungan, dampak ekonominya juga terasa. Hasil panen turun, kualitas beras menurun, harga jual ikut turun. Petani-petani muda mulai enggan bertani, lebih milih kerja di kota."
            },
            {
                text: "Perspektif Umum - Perubahan Tak Jelas", 
                response: "Setelah ada pabrik, ya memang banyak yang berubah, tapi saya kurang tahu pasti sebab-akibatnya. Mungkin ada faktor lain juga."
            }
        ]
    },
    farmer_solusi: {
        speaker: "Pak Seno - Solusi & Harapan",
        text: "Tentang harapan dan solusi untuk mengatasi masalah ini...",
        tag: "Solusi",
        choices: [
            {
                text: "Audit Independen - Transparansi Data", 
                response: "Yang paling saya harapkan adalah audit independen yang transparan. Tim netral yang benar-benar tes air dan tanah, hasilnya diumumkan terbuka. Kalau terbukti pabrik salah, harus diperbaiki. Kalau tidak, kita juga harus terima."
            },
            {
                text: "Dialog Multi-Stakeholder", 
                response: "Menurut saya, pemerintah desa, pengelola pabrik, dan petani harus duduk bersama. Evaluasi air dan lahan secara ilmiah, bukan asal tuduh. Semua pihak harus terbuka dan jujur."
            },
            {
                text: "Refleksi Perspektif", 
                response: "Awalnya saya yakin pasti pabrik penyebab semua masalah. Tapi setelah dengar argumen dan dokumen dari mereka, saya mulai sadar perlu bukti yang kuat sebelum menyalahkan siapa-siapa."
            }
        ]
    },
    pabrik: {
        speaker: "Bu Anita - Pemilik Pabrik",
        text: "Selamat datang! Saya Bu Anita, pemilik pabrik pengolahan hasil pertanian. Kami berkomitmen untuk beroperasi secara bertanggung jawab dan berkelanjutan. Kami terbuka untuk diskusi dan transparansi.",
        tag: "Industri",
        choices: [
            {
                text: "üî¨ Sistem Pengolahan Limbah", 
                submenu: "pabrik_limbah"
            },
            {
                text: "ü§ù Hubungan dengan Komunitas", 
                submenu: "pabrik_komunitas"
            },
            {
                text: "üìä Dampak & Kebijakan", 
                submenu: "pabrik_dampak"
            }
        ]
    },
    pabrik_limbah: {
        speaker: "Bu Anita - Sistem Pengolahan Limbah",
        text: "Tentang sistem pengelolaan limbah dan standar operasional kami...",
        tag: "Teknis",
        choices: [
            {
                text: "IPAL & Monitoring Independen", 
                response: "Kami punya sistem IPAL (Instalasi Pengolahan Air Limbah) yang diuji dua pekan sekali oleh tim independen dari Dinas Lingkungan Hidup. Laporan pengujian air selalu dicatat dan dokumen tersedia untuk publik. Kami juga terbuka jika warga ingin inspeksi langsung."
            },
            {
                text: "Sertifikasi & Compliance", 
                response: "Pabrik sudah tersertifikasi ISO 14001 untuk manajemen lingkungan. Kami mengikuti semua regulasi yang ditetapkan pemerintah, bahkan beberapa parameter kami set lebih ketat dari standar minimum yang disyaratkan."
            },
            {
                text: "Perspektif Sederhana", 
                response: "Pabrik sudah punya alat pengolah limbah kok, pasti tidak mungkin langsung buang air kotor ke sungai begitu saja."
            }
        ]
    },
    pabrik_komunitas: {
        speaker: "Bu Anita - Hubungan dengan Komunitas",
        text: "Tentang hubungan kami dengan masyarakat desa dan upaya-upaya yang telah dilakukan...",
        tag: "Sosial",
        choices: [
            {
                text: "Analisis Komunikasi & Dialog", 
                response: "Jujur, kurangnya komunikasi dan minimnya data objektif yang diterima kedua pihak menjadi masalah utama. Kami kadang lalai dalam sosialisasi rutin, sementara warga juga kurang proaktif mencari informasi faktual."
            },
            {
                text: "Program CSR & Evaluasi", 
                response: "Program CSR baru berjalan setahun. Kami evaluasi dari survei kepuasan warga dan realisasi bantuan alat pertanian modern. Beberapa program memang kurang efektif, makanya tahun depan akan ada penyesuaian berdasarkan feedback masyarakat."
            },
            {
                text: "Komitmen Transparansi", 
                response: "Setelah mendengar aspirasi warga kemarin, saya sadar perlu transparansi data limbah secara berkala dan pengawasan rutin yang melibatkan perwakilan warga. Kita akan bentuk tim monitoring bersama."
            }
        ]
    },
    pabrik_dampak: {
        speaker: "Bu Anita - Dampak & Kebijakan",
        text: "Tentang dampak operasional dan kebijakan masa depan...",
        tag: "Strategi",
        choices: [
            {
                text: "Analisis Dampak Pembatasan", 
                response: "Kalau produksi dibatasi drastis, efisiensi operasional turun dan kemungkinan ada pengurangan pekerja lokal. Namun, jika memang terbukti limbah kami bermasalah, kami siap investasi perbaikan proses meski biaya operasional naik."
            },
            {
                text: "Proposal Audit Bersama", 
                response: "Mari kita duduk bersama dengan petani dan pemerintah desa. Kita adakan audit independen dengan biaya ditanggung tiga pihak agar hasilnya benar-benar netral. Pabrik terbuka untuk diskusi dan perbaikan."
            },
            {
                text: "Perspektif Sederhana", 
                response: "Saya harap petani bisa lebih percaya bahwa pabrik tidak bermaksud jahat. Kami juga warga desa ini."
            }
        ]
    }
};<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Realistic avatars ‚Äî Networked-Aframe</title>
<meta name="description" content="Realistic avatars ‚Äî Networked-Aframe" />

<script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.min.js"></script>
<script src="/easyrtc/easyrtc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/networked-aframe@0.14.0/dist/networked-aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fern-solutions/aframe-mirror@1.1.1/dist/mirror.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.6.0/dist/aframe-cursor-teleport-component.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AdaRoseCannon/aframe-xr-boilerplate@bca4792/simple-navmesh-constraint.js"></script>

<script src="/dist/components.js"></script>
<script defer src="/dist/ui.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

#npc-dialog-overlay {
position: fixed;
left: 0; top: 0; right: 0; bottom: 0;
background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(30,58,138,0.3));
backdrop-filter: blur(8px);
z-index: 1000;
display: flex;
align-items: center;
justify-content: center;
animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

@keyframes slideUp {
from { 
  transform: translateY(30px); 
  opacity: 0; 
}
to { 
  transform: translateY(0); 
  opacity: 1; 
}
}

#npc-dialog-box {
background: linear-gradient(145deg, #ffffff, #f8fafc);
border-radius: 20px;
box-shadow: 
  0 25px 50px -12px rgba(0, 0, 0, 0.25),
  0 0 0 1px rgba(255, 255, 255, 0.1),
  inset 0 1px 0 rgba(255, 255, 255, 0.2);
padding: 2.5em 2.5em 2em 2.5em;
min-width: 400px;
max-width: 85vw;
max-height: 85vh;
overflow: hidden;
font-family: 'Inter', system-ui, -apple-system, sans-serif;
position: relative;
animation: slideUp 0.4s ease-out;
border: 1px solid rgba(226, 232, 240, 0.8);
}

#npc-dialog-box::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 4px;
background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
border-radius: 20px 20px 0 0;
}

#npc-dialog-box h3 {
margin: 0 0 0.8em 0;
font-size: 1.4em;
font-weight: 600;
color: #1e293b;
display: flex;
align-items: center;
gap: 0.5em;
}

#npc-dialog-box h3::before {
content: 'üí¨';
font-size: 1.2em;
}

.dialog-content {
max-height: 60vh;
overflow-y: auto;
padding-right: 0.5em;
margin-bottom: 1.5em;
}

.dialog-content::-webkit-scrollbar {
width: 6px;
}

.dialog-content::-webkit-scrollbar-track {
background: #f1f5f9;
border-radius: 3px;
}

.dialog-content::-webkit-scrollbar-thumb {
background: #cbd5e1;
border-radius: 3px;
}

.dialog-content::-webkit-scrollbar-thumb:hover {
background: #94a3b8;
}

#npc-dialog-text {
margin: 0 0 1.5em 0;
color: #334155;
line-height: 1.6;
font-size: 1em;
font-weight: 400;
background: linear-gradient(145deg, #f8fafc, #f1f5f9);
padding: 1.5em;
border-radius: 12px;
border: 1px solid #e2e8f0;
position: relative;
}

#npc-dialog-text::before {
content: '"';
position: absolute;
top: -0.2em;
left: 0.5em;
font-size: 3em;
color: #cbd5e1;
font-family: serif;
}

#npc-dialog-choices {
margin-bottom: 1.5em;
display: grid;
gap: 0.75em;
}

#npc-dialog-choices button {
padding: 1em 1.5em;
background: linear-gradient(145deg, #ffffff, #f8fafc);
color: #374151;
border: 2px solid #e5e7eb;
border-radius: 12px;
font-size: 0.95em;
font-weight: 500;
cursor: pointer;
text-align: left;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
position: relative;
overflow: hidden;
font-family: 'Inter', sans-serif;
line-height: 1.4;
}

#npc-dialog-choices button::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
transition: left 0.5s;
}

#npc-dialog-choices button:hover {
background: linear-gradient(145deg, #f0f9ff, #e0f2fe);
border-color: #3b82f6;
transform: translateY(-2px);
box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.25);
color: #1e40af;
}

#npc-dialog-choices button:hover::before {
left: 100%;
}

#npc-dialog-choices button:active {
transform: translateY(0);
}

.choice-primary {
background: linear-gradient(145deg, #3b82f6, #2563eb) !important;
color: white !important;
border-color: #1d4ed8 !important;
}

.choice-primary:hover {
background: linear-gradient(145deg, #2563eb, #1d4ed8) !important;
border-color: #1e40af !important;
color: white !important;
}

.choice-secondary {
background: linear-gradient(145deg, #10b981, #059669) !important;
color: white !important;
border-color: #047857 !important;
}

.choice-secondary:hover {
background: linear-gradient(145deg, #059669, #047857) !important;
border-color: #065f46 !important;
color: white !important;
}

.back-button {
background: linear-gradient(145deg, #6b7280, #4b5563) !important;
color: white !important;
border-color: #374151 !important;
margin-top: 1em !important;
}

.back-button:hover {
background: linear-gradient(145deg, #4b5563, #374151) !important;
border-color: #1f2937 !important;
color: white !important;
}

.back-button::before {
content: '‚Üê ';
margin-right: 0.5em;
}

.dialog-actions {
display: flex;
justify-content: center;
gap: 1em;
padding-top: 1em;
border-top: 1px solid #e2e8f0;
}

#npc-dialog-close {
padding: 0.75em 2em;
background: linear-gradient(145deg, #ef4444, #dc2626);
color: white;
border: none;
border-radius: 10px;
font-size: 0.95em;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
font-family: 'Inter', sans-serif;
box-shadow: 0 4px 14px 0 rgba(239, 68, 68, 0.25);
}

#npc-dialog-close:hover {
background: linear-gradient(145deg, #dc2626, #b91c1c);
transform: translateY(-1px);
box-shadow: 0 6px 20px 0 rgba(239, 68, 68, 0.35);
}

#npc-dialog-close:active {
transform: translateY(0);
}

.breadcrumb {
display: flex;
align-items: center;
gap: 0.5em;
margin-bottom: 1em;
font-size: 0.85em;
color: #64748b;
font-weight: 500;
}

.breadcrumb-item {
display: flex;
align-items: center;
gap: 0.5em;
}

.breadcrumb-separator {
color: #cbd5e1;
}

.dialog-tag {
display: inline-block;
background: linear-gradient(145deg, #f0f9ff, #e0f2fe);
color: #0369a1;
padding: 0.25em 0.75em;
border-radius: 20px;
font-size: 0.75em;
font-weight: 600;
margin-left: auto;
border: 1px solid #bae6fd;
}

@media (max-width: 768px) {
#npc-dialog-box {
  min-width: 320px;
  margin: 1em;
  padding: 2em 1.5em 1.5em 1.5em;
}

#npc-dialog-choices {
  gap: 0.5em;
}

#npc-dialog-choices button {
  padding: 0.75em 1em;
  font-size: 0.9em;
}
}
</style>
</head>

<body>
<a-scene
networked-scene="
connectOnLoad: false;
room: japan;
debug: true;
adapter: wseasyrtc;
"
shadow="type: pcfsoft"
gltf-model="meshoptDecoderPath:https://unpkg.com/meshoptimizer@0.19.0/meshopt_decoder.js"
raycaster="far: 3; objects: .clickable"
cursor="rayOrigin: mouse"
>
<a-assets>
<template id="avatar-template">
  <a-entity player-info>
    <a-entity class="model">
      <a-text class="nametag" align="center" value="?" position="0 2.1 0" scale=".5 .5 .5"></a-text>
    </a-entity>
    <a-entity class="camera" position="0 1.6 0"></a-entity>
  </a-entity>
</template>

<img id="thumbJapan" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/japan.png" alt="Japan" />
<img id="thumbForest" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png" alt="Forest" />
</a-assets>

<a-entity id="scene">
    <a-sky color="#87CEEB"></a-sky>
        <a-asset-item id="village-model" src="villageNaruto.glb" >
        </a-asset-item>
     <!-- Tambahkan ini di dalam a-entity id="scene" -->
<a-entity gltf-model="#village-model" position="0 0 -10" scale="1 1 1"  material="color: #7BC8A4; metalness: 0; roughness: 1"></a-entity>
<a-entity light="type: directional; color: #FFFFFF; intensity: 0.8" 
          position="-1 2 1"></a-entity>
<a-entity light="type: hemisphere; color: #FFFFFF; groundColor: #808080; intensity: 0.5"></a-entity>

<!-- Model desa dengan penyesuaian material -->
<a-entity gltf-model="#village-model" 
          position="0 0 -10" 
          scale="1 1 1"
          shadow="receive: true">
</a-entity>
<!-- <a-entity light="type:ambient;intensity:0.5"></a-entity> -->

<!-- NPC Koordinator -->
<a-entity id="koordinator"
    gltf-model="url(models/wise_man_33.glb)"
    scale="1 1 1"
    position="-45 1 5"
    data-dialog="koordinator"
    class="clickable">
    <a-cylinder radius="1.2" height="0.65" material="opacity: 0; transparent: true" position="0 0.9 0"></a-cylinder>

    <a-text position="0 2.2 0" value="Koordinator Peneliti\nDr. Ahmad Surya"
    align="center" color="#2F4F4F" 
    geometry="primitive: plane; width: auto; height: auto"
    material="color: rgba(255,255,255,0.9); opacity: 0.9"
    text="width: 8; wrapCount: 20"
    animation__bob="property: position; to: 0 2.4 0; dir: alternate; dur: 2000; loop: true">
    </a-text>
</a-entity>

<!-- NPC Pak Seno (Farmer) - dipisahkan posisinya -->
<a-entity id="farmer"
    gltf-model="url(models/farmer.glb)"
    scale="1 1 1"
    position="-53 1 5"
    rotation="0 30 0"
    data-dialog="farmer"
    class="clickable">
    <a-cylinder radius="1.2" height="0.65" material="opacity: 0; transparent: true" position="0 0.9 0"></a-cylinder>

    <a-text position="0 2.2 0" value="Pak Seno\n(Petani Senior)"
    align="center" color="#2F4F4F" 
    geometry="primitive: plane; width: auto; height: auto"
    material="color: rgba(255,255,255,0.9); opacity: 0.9"
    text="width: 8; wrapCount: 20"
    animation__bob="property: position; to: 0 2.4 0; dir: alternate; dur: 2000; loop: true">
    </a-text>
</a-entity>

<!-- NPC Bu Anita (Pemilik Pabrik) - posisi baru -->
<a-entity id="pabrik-owner"
    gltf-model="url(models/low_poly_little_girl.glb)"
    scale="1 1 1"
    position="-60 1 5"
    rotation="0 50 0"
    data-dialog="pabrik"
    class="clickable">
    <a-cylinder radius="1.2" height="0.65" material="opacity: 0; transparent: true" position="0 0.9 0"></a-cylinder>

    <a-text position="0 2.2 0" value="Bu Anita\n(Pemilik Pabrik)"
    align="center" color="#2F4F4F" 
    geometry="primitive: plane; width: auto; height: auto"
    material="color: rgba(255,255,255,0.9); opacity: 0.9"
    text="width: 8; wrapCount: 20"
    animation__bob="property: position; to: 0 2.4 0; dir: alternate; dur: 2000; loop: true">
    </a-text>
</a-entity>

<a-link
  change-room="on:obbcollisionstarted;room:forest;url:index.html"
  link="on:ignore"
  href="forest"
  position="-10 1 13"
  image="#thumbForest"
>
  <a-box position="0 0 0.5" obb-collider visible="false"></a-box>
</a-link>
</a-entity>

<!-- Player rig -->
<a-entity
id="rig"
position="-50 1 5"
cursor-teleport="cameraRig: #rig; cameraHead: #player; collisionEntities: .environmentGround; ignoreEntities: .clickable,[link]"
simple-navmesh-constraint="navmesh:.environmentGround,.environmentDressing;fall:10;height:0;exclude:.navmesh-hole;"
movement-controls="fly:false;controls: gamepad, trackpad, keyboard, nipple;"
spawn-in-circle="radius:1"
networked="template:#avatar-template;attachTemplateToLocal:false"
player-info
>
<a-entity id="player" class="camera" camera position="0 1.6 0" look-controls>
  <a-box obb-collider visible="false" height="0.4" depth="0.4" width="0.4"></a-box>
</a-entity>
</a-entity>
</a-scene>

<div id="npc-dialog-overlay" style="display:none;">
<div id="npc-dialog-box">
<div class="breadcrumb" id="dialog-breadcrumb" style="display:none;">
  <span class="breadcrumb-item">
    <span id="breadcrumb-main">Dialog Utama</span>
  </span>
  <span class="breadcrumb-separator">‚Ä∫</span>
  <span class="breadcrumb-item">
    <span id="breadcrumb-current">Topik Saat Ini</span>
  </span>
</div>

<h3 id="npc-dialog-speaker">
  <span class="dialog-tag" id="dialog-tag">Penelitian</span>
</h3>

<div class="dialog-content">
  <div id="npc-dialog-text"></div>
  <div id="npc-dialog-choices"></div>
</div>

<div class="dialog-actions">
  <button id="npc-dialog-close">Tutup Dialog</button>
</div>
</div>
</div>

<script>
let gameState = {
    currentDialog: null,
};

const dialogData = {
    koordinator: {
        speaker: "Dr. Ahmad Surya - Koordinator Peneliti",
        text: "Selamat datang di Desa Harmoni! Sebagai sosiolog senior, tugasmu adalah mengumpulkan data obyektif tentang konflik kompleks antara sektor pertanian dan industri. Ingat, kebenaran sosiologis terletak pada triangulasi data dari berbagai sumber. Jangan terburu-buru membuat kesimpulan sebelum mendengar semua pihak.",
        choices: [
            {
                text: "Apa metodologi penelitian yang harus saya gunakan?", 
                response: "Gunakan pendekatan etnografi partisipatif. Observasi langsung kondisi lapangan, wawancara mendalam dengan stakeholder, dan analisis dokumen sekunder. Catat bias potensial dari setiap sumber informasi."
            },
            {
                text: "Siapa saja key informant yang perlu saya temui?", 
                response: "Pak Seno sebagai petani senior dengan pengalaman 20 tahun, Bu Anita pemilik pabrik dengan latar belakang teknik lingkungan, data objektif di perpustakaan, dan kepala desa sebagai mediator. Masing-masing punya perspektif berbeda."
            },
            {
                text: "Bagaimana cara mengidentifikasi data yang valid?", 
                response: "Cross-check informasi dari multiple sources. Perhatikan konsistensi data, kredibilitas sumber, dan bukti empiris. Dokumentasi foto, video, atau pengukuran langsung akan memperkuat validitas temuan Anda."
            }
        ]
    },
    farmer: {
        speaker: "Pak Seno - Petani Senior",
        text: "Selamat datang di desa kami. Saya sudah bertani di sini 20 tahun. Belakangan ini ada banyak perubahan yang membuat kami petani khawatir. Silakan tanya apa yang ingin Anda ketahui.",
        choices: [
            {
                text: "Bagaimana Bapak menggambarkan kondisi lahan dan hasil panen dalam dua tahun terakhir?", 
                submenu: "farmer_kondisi"
            },
            {
                text: "Apa perubahan utama yang terjadi sejak pabrik berdiri di pinggir desa?", 
                submenu: "farmer_perubahan"
            },
            {
                text: "Siapa menurut Bapak yang seharusnya bertanggung jawab jika hasil panen menurun?", 
                submenu: "farmer_tanggung_jawab"
            },
            {
                text: "Jika masalah air terus terjadi, apa dampak yang Bapak khawatirkan?", 
                submenu: "farmer_dampak"
            },
            {
                text: "Apa saran Bapak untuk menyelesaikan konflik petani dan pabrik?", 
                submenu: "farmer_saran"
            },
            {
                text: "Setelah mendengar sisi pabrik dan pemerintah desa, adakah pandangan Bapak yang berubah?", 
                submenu: "farmer_refleksi"
            }
        ]
    },
    farmer_kondisi: {
        speaker: "Pak Seno - Kondisi Lahan dan Panen",
        text: "Tentang kondisi lahan dan hasil panen...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Dua tahun terakhir, daun padi banyak yang menguning. Hasil panen menurun sampai 30%, padahal sebelumnya selalu cukup untuk kebutuhan keluarga. Saya catat perubahan itu mulai setelah pabrik berdiri."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Panennya nggak begitu bagus, ya sudah namanya nasib petani kadang untung kadang rugi."
            }
        ]
    },
    farmer_perubahan: {
        speaker: "Pak Seno - Perubahan Sejak Pabrik Berdiri",
        text: "Tentang perubahan yang terjadi...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Yang jelas, air irigasi makin keruh, baunya menyengat. Saya bandingkan dengan sawah Pak Harjo di ujung desa, wilayahnya yang airnya bersih hasilnya lebih baik. Ada perubahan yang bukan cuma karena musim."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Setelah ada pabrik, ya memang banyak yang berubah, tapi saya kurang tahu sebab pastinya."
            }
        ]
    },
    farmer_tanggung_jawab: {
        speaker: "Pak Seno - Tanggung Jawab",
        text: "Tentang siapa yang bertanggung jawab...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Menurut saya, pemerintah desa dan pengelola pabrik harus duduk bersama dengan petani; evaluasi air dan lahan secara ilmiah, bukan asal tuduh."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Ya siapa aja yang penting masalah ini cepat selesai, saya ikut saja kata kepala desa."
            }
        ]
    },
    farmer_dampak: {
        speaker: "Pak Seno - Dampak yang Dikhawatirkan",
        text: "Tentang dampak jangka panjang...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Kalau ini berlanjut, banyak petani bisa bangkrut, lahan menganggur, orang muda makin enggan bertani, ekonomi desa bisa lumpuh."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Kalau begini terus ya repot juga, mungkin panen makin jelek."
            }
        ]
    },
    farmer_saran: {
        speaker: "Pak Seno - Saran Penyelesaian",
        text: "Tentang solusi yang diharapkan...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Sebaiknya ada tim netral yang benar-benar tes air dan tanah, hasilnya diumumkan terbuka. Kalau terbukti pabrik salah, harus diperbaiki. Kalau tidak, kita juga harus terima."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Sebaiknya pemerintah cepat ambil keputusan supaya tidak gaduh."
            }
        ]
    },
    farmer_refleksi: {
        speaker: "Pak Seno - Refleksi Pandangan",
        text: "Tentang perubahan pandangan setelah mendengar pihak lain...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Awalnya saya yakin pasti pabrik penyebab semua. Tapi setelah dengar dokumen dan argumen mereka, saya sadar harus ada bukti kuat sebelum menyalahkan."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Saya tetap sama saja, pikiran saya nggak berubah."
            }
        ]
    },
    pabrik: {
        speaker: "Bu Anita - Pemilik Pabrik",
        text: "Selamat datang! Saya Bu Anita, pemilik pabrik pengolahan hasil pertanian di desa ini. Kami berkomitmen untuk beroperasi secara bertanggung jawab. Ada yang ingin Anda ketahui tentang operasional kami?",
        choices: [
            {
                text: "Bisa Ibu jelaskan proses pengolahan limbah di pabrik?", 
                submenu: "pabrik_limbah"
            },
            {
                text: "Apa faktor utama yang memengaruhi hubungan pabrik dan petani?", 
                submenu: "pabrik_hubungan"
            },
            {
                text: "Bagaimana Ibu menilai efektivitas CSR pabrik?", 
                submenu: "pabrik_csr"
            },
            {
                text: "Jika aktivitas pabrik dibatasi, apa dampaknya?", 
                submenu: "pabrik_dampak"
            },
            {
                text: "Apa pesan Ibu jika bicara dengan komunitas petani?", 
                submenu: "pabrik_pesan"
            },
            {
                text: "Setelah dengar aspirasi warga, adakah kebijakan yang ingin diubah?", 
                submenu: "pabrik_refleksi"
            }
        ]
    },
    pabrik_limbah: {
        speaker: "Bu Anita - Proses Pengolahan Limbah",
        text: "Tentang pengelolaan limbah pabrik...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Kami punya sistem IPAL yang diuji dua pekan sekali oleh tim independen. Laporan pengujian air selalu dicatat dan bisa dicek. Selain itu, kami terbuka jika warga ingin inspeksi."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Pabrik sudah punya alat pengolah limbah kok, tidak mungkin langsung buang ke sungai."
            }
        ]
    },
    pabrik_hubungan: {
        speaker: "Bu Anita - Hubungan dengan Petani",
        text: "Tentang faktor yang memengaruhi hubungan...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Kurangnya komunikasi dan minimnya data objektif yang diterima kedua pihak. Kami kadang lalai sosialisasi, warga juga kurang mencari fakta."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Mungkin karena adanya pabrik saja, jadi warga pikir itu sumber masalah."
            }
        ]
    },
    pabrik_csr: {
        speaker: "Bu Anita - Efektivitas CSR",
        text: "Tentang program CSR kami...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Program CSR baru jalan setahun. Kami evaluasi dari survei kepuasan warga dan realisasi bantuan alat pertanian. Beberapa program kurang efektif, jadi tahun depan akan diubah."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Sudah ada CSR, pasti cukup membantu warga."
            }
        ]
    },
    pabrik_dampak: {
        speaker: "Bu Anita - Dampak Pembatasan",
        text: "Tentang dampak jika aktivitas dibatasi...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Kalau produksi dibatasi, efisiensi turun, kemungkinan akan ada pengurangan pekerja lokal. Namun, jika terbukti limbah kami bermasalah, kami siap perbaiki proses meski biaya naik."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Kalau dibatasi, pasti perusahaan rugi dan banyak pekerja dirumahkan."
            }
        ]
    },
    pabrik_pesan: {
        speaker: "Bu Anita - Pesan untuk Petani",
        text: "Tentang pesan untuk komunitas petani...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Mari duduk bersama, kita adakan audit independen, biaya dari dua pihak dan pemerintah agar hasilnya netral. Pabrik terbuka diskusi."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Saya harap petani percaya, pabrik tidak jahat."
            }
        ]
    },
    pabrik_refleksi: {
        speaker: "Bu Anita - Refleksi Kebijakan",
        text: "Tentang perubahan kebijakan setelah mendengar aspirasi...",
        choices: [
            {
                text: "Jawaban Kritis", 
                response: "Ya, dengan diskusi terakhir saya sadar perlu transparansi data limbah secara terbuka dan pengawasan rutin oleh warga."
            },
            {
                text: "Jawaban Alternatif", 
                response: "Rasanya kebijakan sudah cukup, mungkin perlu lebih sosialisasi saja."
            }
        ]
    }
};

function showNpcDialog(dialogId) {
  const dialog = dialogData[dialogId];
  if (!dialog) return;

  gameState.currentDialog = dialogId;

  const overlay = document.getElementById('npc-dialog-overlay');
  overlay.style.display = 'flex';

  document.getElementById('npc-dialog-speaker').textContent = dialog.speaker;
  document.getElementById('npc-dialog-text').textContent = dialog.text;

  const choicesDiv = document.getElementById('npc-dialog-choices');
  choicesDiv.innerHTML = '';
  
  if (dialog.choices && dialog.choices.length > 0) {
    dialog.choices.forEach((choice) => {
      const btn = document.createElement('button');
      btn.textContent = choice.text;
      btn.onclick = function() {
        if (choice.submenu) {
          showNpcDialog(choice.submenu);
        } else {
          document.getElementById('npc-dialog-text').textContent = choice.response;
          choicesDiv.innerHTML = '';
          
          // Add back button for submenus
          if (dialogId.includes('_')) {
            const backBtn = document.createElement('button');
            backBtn.textContent = '‚Üê Kembali ke menu utama';
            backBtn.className = 'back-button';
            backBtn.onclick = function() {
              const mainDialog = dialogId.split('_')[0];
              showNpcDialog(mainDialog);
            };
            choicesDiv.appendChild(backBtn);
          }
        }
      };
      choicesDiv.appendChild(btn);
    });
  }

  // Add back button for submenus
  if (dialogId.includes('_') && dialog.choices && dialog.choices.length > 0) {
    const backBtn = document.createElement('button');
    backBtn.textContent = '‚Üê Kembali ke menu utama';
    backBtn.className = 'back-button';
    backBtn.onclick = function() {
      const mainDialog = dialogId.split('_')[0];
      showNpcDialog(mainDialog);
    };
    choicesDiv.appendChild(backBtn);
  }
}

function hideNpcDialog() {
  document.getElementById('npc-dialog-overlay').style.display = 'none';
  gameState.currentDialog = null;
}

document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('npc-dialog-close').onclick = hideNpcDialog;

  // Tambahkan click handler langsung ke semua NPC yang punya data-dialog
  document.querySelectorAll('[data-dialog]').forEach(el => {
    el.addEventListener('click', function () {
      const dialogId = this.getAttribute('data-dialog');
      if (dialogId) {
        showNpcDialog(dialogId);
      }
    });
  });
});
</script>

</body>
</html>
