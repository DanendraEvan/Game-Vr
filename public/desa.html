<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>VR Dialog System - Desa Harmoni</title>
  <meta name="description" content="VR Dialog System dengan A-Frame" />

  <!-- A-Frame & Plugins -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.min.js"></script>
  <script src="/easyrtc/easyrtc.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/networked-aframe@0.14.0/dist/networked-aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fern-solutions/aframe-mirror@1.1.1/dist/mirror.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.6.0/dist/aframe-cursor-teleport-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AdaRoseCannon/aframe-xr-boilerplate@bca4792/simple-navmesh-constraint.js"></script>
  <script src="/dist/components.js"></script>
  <script defer src="/dist/ui.js"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body { background: #222; }
    /* Hide scrollbars on desktop */
    ::-webkit-scrollbar { width: 0 !important }
  </style>
</head>
<body>
<a-scene
  networked-scene="connectOnLoad: false; room: japan; debug: true; adapter: wseasyrtc;"
  shadow="type: pcfsoft"
  gltf-model="meshoptDecoderPath:https://unpkg.com/meshoptimizer@0.19.0/meshopt_decoder.js"
  raycaster="far: 3; objects: .clickable"
  cursor="rayOrigin: mouse"
  vr-detector
>
  <a-assets>
    <template id="avatar-template">
      <a-entity player-info>
        <a-entity class="model">
          <a-text class="nametag" align="center" value="?" position="0 2.1 0" scale=".5 .5 .5"></a-text>
        </a-entity>
        <a-entity class="camera" position="0 1.6 0"></a-entity>
      </a-entity>
    </template>
    <img id="thumbJapan" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/japan.png" alt="Japan" />
    <img id="thumbForest" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png" alt="Forest" />
    <a-asset-item id="village-model" src="villageNaruto.glb"></a-asset-item>
  </a-assets>

  <a-entity id="scene">
    <a-sky color="#87CEEB"></a-sky>
    <a-entity gltf-model="#village-model" position="0 0 -10" scale="0.7 0.7 0.7" material="color: #7BC8A4; metalness: 0; roughness: 1"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.8" position="-1 2 1"></a-entity>
    <a-entity light="type: hemisphere; color: #FFF; groundColor: #808080; intensity: 0.5"></a-entity>
    <a-entity gltf-model="#village-model" position="0 0 -10" scale="1 1 1" shadow="receive: true"></a-entity>

    <!-- NPC Koordinator -->
    <a-entity id="koordinator"
      gltf-model="url(models/wise_man_33.glb)"
      scale="1 1 1"
      position="-56 2 4"
      data-dialog="koordinator"
      rotation="0 70 0">
      <a-cylinder radius="1.2" height="0.45" material="opacity: 0; transparent: true" position="0 0.5 0"></a-cylinder>
      <a-text position="0 2.2 0" value="Koordinator Peneliti\nDr. Ahmad Surya"
        align="center" color="#2F4F4F"
        geometry="primitive: plane; width: auto; height: auto"
        material="color: #fff; opacity: 0.9"
        text="width: 8; wrapCount: 20"
        animation__bob="property: position; to: 0 2.4 0; dur: 2000; loop: true">
      </a-text>
    </a-entity>

    <!-- NPC Pak Seno -->
    <a-entity id="farmer"
      gltf-model="url(models/farmer.glb)"
      scale="1 1 1"
      position="-55 1 27"
      rotation="0 30 0"
      data-dialog="farmer">
      <a-cylinder radius="1.2" height="0.65" material="opacity: 0; transparent: true" position="0 0.9 0"></a-cylinder>
      <a-text position="0 2.2 0" value="Pak Seno\n(Petani Senior)"
        align="center" color="#2F4F4F"
        geometry="primitive: plane; width: auto; height: auto"
        material="color: #fff; opacity: 0.9"
        text="width: 8; wrapCount: 20"
        animation__bob="property: position; to: 0 2.4 0; dir: alternate; dur: 2000; loop: true">
      </a-text>
    </a-entity>

    <!-- NPC Bu Anita -->
    <a-entity id="pabrik-owner"
      gltf-model="url(models/low_poly_little_girl.glb)"
      scale="1 1 1"
      position="-86 2 -5"
      rotation="0 50 0"
      data-dialog="pabrik">
      <a-cylinder radius="1.2" height="0.65" material="opacity: 0; transparent: true" position="0 0.9 0"></a-cylinder>
      <a-text position="0 2.2 0" value="Bu Anita\n(Pemilik Pabrik)"
        align="center" color="#2F4F4F"
        geometry="primitive: plane; width: auto; height: auto"
        material="color: #fff; opacity: 0.9"
        text="width: 8; wrapCount: 20"
        animation__bob="property: position; to: 0 2.4 0; dir: alternate; dur: 2000; loop: true">
      </a-text>
    </a-entity>

    <a-link
      change-room="on:obbcollisionstarted;room:forest;url:index.html"
      link="on:ignore"
      href="forest"
      position="-10 1 13"
      image="#thumbForest">
      <a-box position="0 0 0.5" obb-collider visible="false"></a-box>
    </a-link>

    <!-- Info Dialog on Load -->
    <a-entity id="info-dialog-onload" position="0 4 -8">
      <a-plane width="7" height="1.2" color="#1e293b" opacity="0.92" material="shader: flat"></a-plane>
      <a-text 
        value="Selamat datang di Desa Harmoni! Silakan jelajahi desa ini. Klik pada NPC dinonaktifkan untuk saat ini."
        align="center"
        color="#fff"
        position="0 0 0.05"
        text="width: 12; wrapCount: 60; font: dejavu; weight: bold"></a-text>
    </a-entity>

    <!-- VR Dialog System (hidden, not used) -->
    <a-entity id="vr-dialog-system"
      visible="false"
      position="0 2 -2"
      look-at-camera
      animation__appear="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; dur: 500; easing: easeOutBack"
      animation__disappear="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; dur: 300; easing: easeInBack">
      <a-plane id="dialog-background"
        width="7"
        height="5"
        color="#fff"
        opacity="0.1"
        material="transparent: true; shader: flat"
        position="0 0 -0.01">
        <a-plane width="7.2" height="5.2"
          color="#3b82f6"
          position="0 0 -0.02"
          opacity="0.3"
          material="transparent: true; shader: flat"></a-plane>
        <a-plane width="6.8" height="4.8"
          color="#fff"
          position="0 0 -0.005"
          opacity="0.8"
          material="transparent: true; shader: flat"></a-plane>
      </a-plane>
      <a-plane width="7" height="0.8" color="#1e293b" position="0 2.1 0" opacity="0.9">
        <a-text id="dialog-speaker"
          value="Speaker Name"
          position="0 0 0.01"
          align="center"
          color="#fff"
          text="width: 14; wrapCount: 50; font: dejavu; weight: bold"></a-text>
      </a-plane>
      <a-plane width="6.5" height="2.5" color="#f8fafc" position="0 0.5 0" opacity="0.95">
        <a-text id="dialog-text"
          value="Dialog text will appear here..."
          position="0 0 0.01"
          align="center"
          color="#334155"
          text="width: 12; wrapCount: 80; font: dejavu; lineHeight: 50"></a-text>
      </a-plane>
      <a-entity id="dialog-choices" position="0 -1.2 0"></a-entity>
      <a-box id="dialog-close-btn"
        width="2"
        height="0.5"
        depth="0.1"
        color="#ef4444"
        position="0 -2.2 0.05"
        class="clickable"
        vr-clickable
        material="shader: standard; metalness: 0.3; roughness: 0.4"
        animation__hover="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
        animation__leave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200"
        animation__click="property: scale; to: 0.9 0.9 0.9; startEvents: click; dur: 100">
        <a-text value="âœ• Tutup Dialog"
          align="center"
          position="0 0 0.06"
          color="white"
          text="width: 10; font: dejavu; weight: bold"></a-text>
      </a-box>
      <a-text value="Arahkan cursor dan klik untuk memilih"
        position="0 -2.8 0"
        align="center"
        color="#64748b"
        text="width: 8; font: dejavu"
        opacity="0.7"></a-text>
    </a-entity>
  </a-entity>

  <!-- Player rig -->
  <a-entity
    id="rig"
    position="-50 1 5"
    cursor-teleport="cameraRig: #rig; cameraHead: #player; collisionEntities: .environmentGround; ignoreEntities: .clickable,[link]"
    simple-navmesh-constraint="navmesh:.environmentGround,.environmentDressing;fall:10;height:0;exclude:.navmesh-hole;"
    movement-controls="fly:false;controls: gamepad, trackpad, keyboard, nipple;"
    spawn-in-circle="radius:1"
    networked="template:#avatar-template;attachTemplateToLocal:false"
    player-info>
    <a-entity id="player" class="camera" camera position="0 1.6 0" look-controls>
      <a-box obb-collider visible="false" height="0.4" depth="0.4" width="0.4"></a-box>
    </a-entity>
  </a-entity>
</a-scene>

<script>
let gameState = {
  currentDialog: null,
  dialogHistory: [],
  vrMode: false
};

AFRAME.registerComponent('vr-detector', {
  init: function () {
    this.el.addEventListener('enter-vr', () => {
      gameState.vrMode = true;
    });
    this.el.addEventListener('exit-vr', () => {
      gameState.vrMode = false;
    });
  }
});

// --- DIALOG DATA (unchanged, see original for full content) ---
const dialogData = {/* ... (same as original, omitted for brevity) ... */};
// --- END DIALOG DATA ---

// --- The rest of the dialog system is disabled for this version ---

// Disable all NPC click events and dialog system
document.addEventListener('DOMContentLoaded', function() {
  // Remove all click handlers from NPCs
  document.querySelectorAll('[data-dialog]').forEach(npc => {
    // Remove clickable class if present
    npc.classList.remove('clickable');
    // Remove all event listeners by cloning
    const newNpc = npc.cloneNode(true);
    npc.parentNode.replaceChild(newNpc, npc);
  });
  // Hide VR dialog system if visible
  var dialogSystem = document.getElementById('vr-dialog-system');
  if (dialogSystem) {
    dialogSystem.setAttribute('visible', false);
  }
});
</script>
</body>
</html>
