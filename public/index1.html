<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="description" content="" />

    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.min.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/networked-aframe@0.14.0/dist/networked-aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fern-solutions/aframe-mirror@1.1.1/dist/mirror.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.6.0/dist/aframe-cursor-teleport-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls@0.4.3/dist/aframe-blink-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AdaRoseCannon/aframe-xr-boilerplate@bca4792/simple-navmesh-constraint.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-gltf-model-plus@1.0.0/dist/gltf-model-plus.min.js"></script>
    <script>
      window.uiSettings = {
        showRandomAvatarButton: true,
        showDieButton: true,
      };
    </script>
    <script src="/dist/components.js"></script>
    <script defer src="/dist/ui.js"></script>

    <style>
      /* Loader overlay */
      #loader {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 9999;
        color: white;
        font-family: sans-serif;
      }
      #loader progress {
        width: 50%;
        height: 20px;
      }
    </style>
  </head>

  <body>
    <!-- Loading overlay -->
    <div id="loader">
      <h2>Loading Assets...</h2>
      <progress id="progressbar" value="0" max="100"></progress>
    </div>

    <a-scene
      light="defaultLightsEnabled:false"
      renderer="stencil:true"
      networked-scene="
        connectOnLoad: false;
        room: forest;
        debug: true;
        adapter: wseasyrtc;
        audio: false;
        video: false;
      "
      shadow="type: pcfsoft"
      gltf-model="meshoptDecoderPath:https://unpkg.com/meshoptimizer@0.19.0/meshopt_decoder.js"
      raycaster="far: 100; objects: .clickable,[link];"
      cursor="rayOrigin: mouse"
    >
      <a-assets timeout="60000">
        <!-- Avatar template -->
        <template id="avatar-template">
          <a-entity player-info>
            <a-entity class="model">
              <a-text class="nametag" align="center" value="?" position="0 2.1 0" scale=".5 .5 .5"></a-text>
            </a-entity>
            <a-entity class="camera" position="0 1.6 0"></a-entity>
          </a-entity>
        </template>

        <!-- Preload villageNaruto outside of template -->
        <a-asset-item id="village-model" src="models/Untitled.glb"></a-asset-item>
        <a-asset-item id="signArrow" src="models/signArrow.glb"></a-asset-item>

        <!-- Thumbnails -->
        <img id="thumbJapan" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/japan.png" />
        <img id="thumbForest" crossorigin="anonymous" src="https://cdn.aframe.io/link-traversal/thumbs/forest.png" />

      </a-assets>

      <a-entity id="scene">
        <!-- Enhanced Environment with Sky -->
        <a-sky color="#87CEEB" opacity="0.8"></a-sky>
        <a-entity environment="preset:none;shadow:true"></a-entity>
        
        <!-- Enhanced Lighting -->
        <a-entity light="type:ambient;intensity:0.4"></a-entity>
        <a-entity light="type:directional;intensity:0.6;castShadow:true" position="5 10 2"></a-entity>
        <a-entity light="type:point;intensity:0.3;color:#FFE4B5" position="0 3 -5"></a-entity>
        
        <a-entity gltf-model="#loby-model" position="0 0 -10" scale="2 2 2" shadow="receive: true"></a-entity>
        
        <a-mirror id="mirror" position="1 1.8 10" scale="30 15 30" layers="0,3" rotation="0 180 0">
          <a-box position="0 0 -0.02" scale="1.02 1.02 0.01"></a-box>
        </a-mirror>
        <a-plane position="-12 5 -5" width="40" height="820" color="black" opacity="1" rotation="0 90 90"></a-plane>
        <a-plane position="12 5 -5" width="40" height="820" color="black" opacity="1" rotation="0 270 90"></a-plane>
        <a-plane position="0 0 0" width="40" height="820" color="black" opacity="1" rotation="-90 0 0"></a-plane>

        <!-- Enhanced Portal with Glow Effect -->
        <a-link
          id="portal-desa"
          href="MiniGame.html"
          title="Desa Harmoni"
          image="#thumbForest"
          position="0 1.5 -90"
          animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; dur: 2000; loop: true"
        >
          <a-box obb-collider visible="false"></a-box>
          <!-- Portal Glow Effect -->
          <a-ring color="#00FF00" opacity="0.3" radius-inner="1.2" radius-outer="1.5" position="0 0 -0.1"
                  animation="property: rotation; to: 0 0 360; dur: 8000; loop: true"></a-ring>
        </a-link>
        <a-link
          id="portal-perpus"
          href="perpus.html"
          title="Perpustakaan"
          image="#thumbForest"
          position="-6 1.5 -90"
          animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; dur: 2000; loop: true"
        >
          <a-box obb-collider visible="false"></a-box>
          <!-- Portal Glow Effect -->
          <a-ring color="#00FF00" opacity="0.3" radius-inner="1.2" radius-outer="1.5" position="0 0 -0.1"
                  animation="property: rotation; to: 0 0 360; dur: 8000; loop: true"></a-ring>
        </a-link>
        <a-link
          id="portal-misiAngket"
          href="misiAngket.html"
          title="Misi Angket"
          image="#thumbForest"
          position="6 1.5 -90"
          animation="property: scale; to: 1.1 1.1 1.1; dir: alternate; dur: 2000; loop: true"
        >
          <a-box obb-collider visible="false"></a-box>
          <!-- Portal Glow Effect -->
          <a-ring color="#00FF00" opacity="0.3" radius-inner="1.2" radius-outer="1.5" position="0 0 -0.1"
                  animation="property: rotation; to: 0 0 360; dur: 8000; loop: true"></a-ring>
        </a-link>

        <!-- Information Boards -->
        <a-entity id="info-board-1" position="-4 2 -8">
          <a-plane width="3" height="2" color="#2C3E50" opacity="0.9"></a-plane>
          <a-text value="MISI INVESTIGASI\n\n• Temui 3 Petani\n• Wawancarai Kepala Desa\n• Kunjungi Pabrik\n• Baca Dokumen di Perpustakaan"
                  color="#ECF0F1" width="4" align="center" position="0 0 0.01"></a-text>
        </a-entity>

        <a-entity id="info-board-2" position="4 2 -8">
          <a-plane width="3" height="2" color="#8E44AD" opacity="0.9"></a-plane>
          <a-text value="TIPS INVESTIGASI\n\n• Bandingkan cerita berbeda\n• Cari bukti fisik\n• Catat inkonsistensi\n• Jangan mudah percaya"
                  color="#ECF0F1" width="4" align="center" position="0 0 0.01"></a-text>
        </a-entity>



        <!-- Atmospheric Particles in the middle area -->
        <a-sphere radius="0.05" color="#FFD700" opacity="0.6" position="1 3.5 -45"
                  animation="property: position; to: 3 4.5 -47; dur: 8000; loop: true"></a-sphere>
        <a-sphere radius="0.06" color="#00CED1" opacity="0.5" position="-3 2.8 -52"
                  animation="property: position; to: -1 3.8 -54; dur: 6000; loop: true"></a-sphere>
        <a-sphere radius="0.04" color="#FF69B4" opacity="0.7" position="4 3.2 -68"
                  animation="property: position; to: 2 4.2 -66; dur: 7000; loop: true"></a-sphere>
        <a-sphere radius="0.07" color="#98FB98" opacity="0.6" position="-1 2.5 -72"
                  animation="property: position; to: 1 3.5 -74; dur: 5500; loop: true"></a-sphere>

        <!-- Ambient Sound Emitter -->
        <a-entity id="ambient-sound" position="0 0 0"
                  sound="src: url(https://cdn.aframe.io/basic-guide/audio/backgroundnoise.wav); autoplay: true; loop: true; volume: 0.1"></a-entity>

        <a-entity
          id="rig"
          cursor-teleport="cameraRig: #rig; cameraHead: #player; collisionEntities: .environmentGround; ignoreEntities: .clickable,[link]"
          simple-navmesh-constraint="navmesh:.environmentGround,.environmentDressing;fall:10;height:0;exclude:.navmesh-hole;"
          movement-controls="fly:false;controls: gamepad, trackpad, keyboard, nipple;"
          spawn-in-circle="radius:1"
          restrict-cube="minX: -10; maxX: 10; minZ: -95; maxZ: 10"
          networked="template:#avatar-template;attachTemplateToLocal:false"
          player-info
        >
          <a-entity id="player" class="camera" camera position="0 1.6 0" look-controls>
            <a-box obb-collider visible="false" height="0.4" depth="0.4" width="0.4"></a-box>
          </a-entity>
        </a-entity>

        <a-box position="0 0 0" width="20" height="0.1" depth="20" color="##E7B07CFF" opacity="0.2"></a-box>

        <!-- Enhanced Dialog System - Now always visible -->
        <a-entity id="all-dialogs" position="0 1.5 -4">
          <!-- Dialog 1 -->
          <a-entity position="0 1 -1">
            <a-plane width="10" height="8" color="#222" opacity="0.9"></a-plane>
            <a-text 
              value="Selamat datang di Metaverse!\n\nTugasmu: kumpulkan data obyektif. Temui petani, kepala desa, pemilik pabrik, cari fakta di perpustakaan" 
              color="#FFF" 
              width="10" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>

          <!-- Dialog 2 -->
          <a-entity position="0 1 -10">
            <a-plane width="10" height="8" color="#2C3E50" opacity="0.9"></a-plane>
            <a-text 
              value="Jangan langsung percaya satu cerita\nDalam studi kasus ini, kebenaran tersembunyi di banyak kepala dan dokumen" 
              color="#ECF0F1" 
              width="10" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>

          <!-- Dialog 3 -->
          <a-entity position="0 1 -20">
            <a-plane width="10" height="8" color="#8E44AD" opacity="0.9"></a-plane>
            <a-text 
              value="Ingat! Setiap karakter memiliki perspektif berbeda\nBandingkan informasi yang kamu dapat" 
              color="#ECF0F1" 
              width="10" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>

          <!-- Dialog 4 -->
          <a-entity position="0 1 -30">
            <a-plane width="10" height="8" color="#E67E22" opacity="0.9"></a-plane>
            <a-text 
              value="Gunakan papan informasi untuk melihat misi\nPerhatikan setiap detail yang kamu temukan" 
              color="#FFF" 
              width="10" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>

          <!-- Dialog 5 -->
          <a-entity position="0 1 -40">
            <a-plane width="10" height="8" color="#27AE60" opacity="0.9"></a-plane>
            <a-text 
              value="Masuk ke portal di belakangmu untuk memulai\nSelamat menyelidiki!" 
              color="#FFF" 
              width="10" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>


          <!-- desa -->
          <a-entity position="0 3 -87">
            <a-plane width="5" height="2" color="#2980B9" opacity="0.9"></a-plane>
            <a-text 
              value="Masuk ke Desa untuk observasi" 
              color="#F1C40F" 
              width="5" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>
          <!-- desa -->
          <a-entity position="-6 3 -87">
            <a-plane width="5" height="2" color="#2980B9" opacity="0.9"></a-plane>
            <a-text 
              value="Ke Perpustakaan untuk studi dokumentasi" 
              color="#F1C40F" 
              width="5" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>
          <!-- desa -->
          <a-entity position="6 3 -87">
            <a-plane width="5" height="2" color="#2980B9" opacity="0.9"></a-plane>
            <a-text 
              value="Serbarkan angket agar mendapat hasil terbaik" 
              color="#F1C40F" 
              width="5" 
              align="center" 
              position="0 0 0.01">
            </a-text>
          </a-entity>
          




        </a-entity>
        
      </a-entity>
      
    </a-scene>

    <script>
      const loader = document.getElementById('loader');
      const progressbar = document.getElementById('progressbar');
      const assets = document.querySelector('a-assets');

      assets.addEventListener('progress', function (e) {
        if (e.detail && e.detail.loaded && e.detail.total) {
          const percent = (e.detail.loaded / e.detail.total) * 100;
          progressbar.value = percent;
        }
      });

      assets.addEventListener('loaded', function () {
        loader.style.display = 'none';
      });

      AFRAME.registerComponent('restrict-cube', {
        schema: {
          minX: { type: 'number', default: -10 },
          maxX: { type: 'number', default: 10 },
          minZ: { type: 'number', default: -10 },
          maxZ: { type: 'number', default: 10 }
        },
        tick: function () {
          let pos = this.el.object3D.position;
          if (pos.x < this.data.minX) pos.x = this.data.minX;
          if (pos.x > this.data.maxX) pos.x = this.data.maxX;
          if (pos.z < this.data.minZ) pos.z = this.data.minZ;
          if (pos.z > this.data.maxZ) pos.z = this.data.maxZ;
        }
      });

      // Enhanced dialog system - removed interactive elements
      const dialogSteps = [
        "Selamat datang di Metaverse!\n\nTugasmu: kumpulkan data obyektif. Temui petani, kepala desa, pemilik pabrik, cari fakta di perpustakaan",
        "Jangan langsung percaya satu cerita\nDalam studi kasus ini, kebenaran tersembunyi di banyak kepala dan dokumen",
        "Ingat! Setiap karakter memiliki perspektif berbeda\nBandingkan informasi yang kamu dapat",
        "Gunakan papan informasi untuk melihat misi\nPerhatikan setiap detail yang kamu temukan",
        "Masuk ke portal di belakangmu untuk memulai\nSelamat menyelidiki!"
      ];

      // All dialogs are now visible by default, no interaction needed

      // Portal interaction
      const portal = document.querySelector("#portal-desa");
      portal.addEventListener("obbcollisionstarted", () => {
        window.location.href = "desa.html";
      });
      const portal2 = document.querySelector("#portal-perpus");
      portal2.addEventListener("obbcollisionstarted", () => {
        window.location.href = "perpus.html";
      });
      const portal3 = document.querySelector("#portal-misiAngket");
      portal3.addEventListener("obbcollisionstarted", () => {
        window.location.href = "misiAngket.html";
      });



      // Add subtle environmental sounds and interactions
      setTimeout(() => {
        console.log("Enhanced VR Lobby loaded successfully!");
      }, 2000);
    </script>
  </body>
</html>